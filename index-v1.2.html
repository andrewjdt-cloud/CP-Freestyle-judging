<!--
CP Freestyle Judging System
File: index-v1.2.html
Version: v1.2 (FIXED)
Date: 2026-02-15
Notes:
- Numeric keypad competitor entry
- FIX: Desktop + mobile hold-to-submit
- FIX: Haptics restored (slider, submit, keypad)
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CP Freestyle â€“ Judge Panel (v1.2)</title>

<style>
body { font-family: system-ui, sans-serif; background:#111; color:#fff; padding:12px; }
.keypad button { font-size:18px; padding:10px; }
button.submit { font-size:22px; padding:12px; }
button.locked { background:#555; }
</style>
</head>

<body>

<form id="scoreForm">
<input type="hidden" name="entry.1544079831" id="score">

<div id="scoreText" style="font-size:80px">5.0</div>
<input id="slider" type="range" min="0" max="10" step="0.1" value="5">

<div class="keypad">
  <button type="button" onclick="tapDigit(1)">1</button>
  <button type="button" onclick="tapDigit(2)">2</button>
  <button type="button" onclick="tapDigit(3)">3</button>
</div>

<button type="button" class="submit" id="submitBtn">HOLD TO SUBMIT</button>
</form>

<script>
const FORM_ENDPOINT =
  "https://docs.google.com/forms/d/e/1FAIpQLSfb2JIBic9mirDg9_CX80br3jmQ74vaLM3BJITnUDEXfmi0pg/formResponse";

/* ---------- Slider haptics ---------- */
let lastHaptic = 5.0;
slider.addEventListener("input", () => {
  scoreText.textContent = slider.value;
  score.value = slider.value;

  if (Math.abs(slider.value - lastHaptic) >= 0.5 && navigator.vibrate) {
    navigator.vibrate(10);
    lastHaptic = slider.value;
  }
});

/* ---------- Keypad haptics ---------- */
function tapDigit(d) {
  if (navigator.vibrate) navigator.vibrate(5);
}

/* ---------- Hold to submit ---------- */
let holdTimer;
let locked = false;

function startHold(e) {
  if (locked) return;
  e.preventDefault();
  holdTimer = setTimeout(submitScore, 350);
}
function cancelHold() { clearTimeout(holdTimer); }

function submitScore() {
  fetch(FORM_ENDPOINT, { method:"POST", mode:"no-cors", body:new FormData(scoreForm) });
  if (navigator.vibrate) navigator.vibrate([25,30,25]);
  locked = true;
  submitBtn.textContent = "READY FOR NEXT RUN";
  submitBtn.classList.add("locked");
}

/* Desktop */
submitBtn.addEventListener("mousedown", startHold);
submitBtn.addEventListener("mouseup", cancelHold);
submitBtn.addEventListener("mouseleave", cancelHold);

/* Mobile */
submitBtn.addEventListener("touchstart", startHold, { passive:false });
submitBtn.addEventListener("touchend", cancelHold);
submitBtn.addEventListener("touchcancel", cancelHold);
</script>

</body>
</html>
