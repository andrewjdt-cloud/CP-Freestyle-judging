<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CP Freestyle ‚Äì Scoreboard</title>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: system-ui, sans-serif;
}

.container {
  padding: 40px;
}

.header {
  text-align: center;
  margin-bottom: 40px;
}

.header h1 {
  font-size: 48px;
  margin: 0;
  color: #ccc;
}

.competitor {
  font-size: 96px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 30px;
}

.scores {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 20px;
  margin-bottom: 40px;
}

.score-box {
  background: #111;
  border-radius: 16px;
  padding: 20px;
  text-align: center;
}

.score {
  font-size: 64px;
  font-weight: bold;
}

.penalties {
  margin-top: 8px;
  font-size: 14px;
  color: #888;
}

.average {
  text-align: center;
  font-size: 120px;
  font-weight: bold;
  color: #00e676;
}

.label {
  text-align: center;
  font-size: 20px;
  color: #888;
  margin-top: 8px;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h1>CP Freestyle ‚Äì Scoreboard</h1>
  </div>

  <div class="competitor" id="competitor">‚Äî</div>

  <div class="scores" id="scores"></div>

  <div class="average" id="average">‚Äî</div>
  <div class="label">AVERAGE SCORE</div>

</div>

<script>
// üîÅ CONFIG ‚Äî paste your published sheet JSON feed URL here
const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTDCQQr4ioQJWYlFOPmMEE03oy1lnrwx8eHrlP_-NvXMG7GFMkG-rx8Ad-9YP99-IcPgjZZFXFdqa4o/pubhtml?gid=1171869633&single=true";

// Fetch every 2 seconds
setInterval(loadScores, 2000);
loadScores();

async function loadScores() {
  const res = await fetch(SHEET_URL);
  const text = await res.text();

  // Extract values from Google Sheets HTML
  const rows = [...text.matchAll(/<tr[^>]*>(.*?)<\/tr>/gs)]
    .map(r => [...r[1].matchAll(/<td[^>]*>(.*?)<\/td>/gs)].map(c => c[1]));

  if (rows.length < 2) return;

  // Latest 5 rows (judge submissions)
  const latest = rows.slice(1, 6);

  const scoresEl = document.getElementById("scores");
  scoresEl.innerHTML = "";

  let total = 0;
  let count = 0;

  document.getElementById("competitor").textContent = latest[0][0];

  latest.forEach(r => {
    const score = parseFloat(r[2]);
    const penalties = (r[3] || "")
      .replace("Missed Entry (ME)", "ME")
      .replace("Water Landing (WL)", "WL")
      .replace("Move Failure (MF)", "MF");

    if (!isNaN(score)) {
      total += score;
      count++;
    }

    const box = document.createElement("div");
    box.className = "score-box";
    box.innerHTML = `
      <div class="score">${score.toFixed(1)}</div>
      <div class="penalties">${penalties}</div>
    `;

    scoresEl.appendChild(box);
  });

  document.getElementById("average").textContent =
    count ? (total / count).toFixed(2) : "‚Äî";
}
</script>

</body>
</html>
