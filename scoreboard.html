<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CP Freestyle â€“ Scoreboard</title>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: system-ui, sans-serif;
}

.container {
  padding: 40px;
}

.header {
  text-align: center;
  margin-bottom: 40px;
}

.header h1 {
  font-size: 48px;
  margin: 0;
  color: #ccc;
}

.competitor {
  font-size: 96px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 30px;
}

.scores {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 20px;
  margin-bottom: 40px;
}

.score-box {
  background: #111;
  border-radius: 16px;
  padding: 20px;
  text-align: center;
}

.score {
  font-size: 64px;
  font-weight: bold;
}

.penalties {
  margin-top: 8px;
  font-size: 14px;
  color: #888;
}

.average {
  text-align: center;
  font-size: 120px;
  font-weight: bold;
  color: #00e676;
}

.label {
  text-align: center;
  font-size: 20px;
  color: #888;
  margin-top: 8px;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h1>CP Freestyle â€“ Scoreboard</h1>
  </div>

  <div class="competitor" id="competitor">â€”</div>

  <div class="scores" id="scores"></div>

  <div class="average" id="average">â€”</div>
  <div class="label">AVERAGE SCORE</div>

</div>

<script>
// ðŸ”§ CONFIG (no need to touch anything else)
const SHEET_ID = "1v839BJMAiCtXbSwRaS6jDq_oDxZgSYwU5sm4JwzrYUk";
const GID = "1171869633";

// Google Sheets GViz endpoint
const URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;

async function loadScores() {
  const res = await fetch(URL);
  const text = await res.text();

  // Parse GViz JSON
  const json = JSON.parse(text.substring(47, text.length - 2));
  const rows = json.table.rows;

  if (!rows || rows.length < 1) return;

  // Get latest 5 rows
  const latest = rows.slice(-5);

  const scoresEl = document.getElementById("scores");
  scoresEl.innerHTML = "";

  let total = 0;
  let count = 0;

  // Competitor number from the newest row
  document.getElementById("competitor").textContent =
    latest[0].c[0]?.v ?? "â€”";

  latest.forEach(r => {
    const score = r.c[2]?.v;
    let penalties = r.c[3]?.v || "";

    penalties = penalties
      .replace("Missed Entry (ME)", "ME")
      .replace("Water Landing (WL)", "WL")
      .replace("Move Failure (MF)", "MF");

    if (typeof score === "number") {
      total += score;
      count++;
    }

    const box = document.createElement("div");
    box.className = "score-box";
    box.innerHTML = `
      <div class="score">${score?.toFixed(1) ?? "â€”"}</div>
      <div class="penalties">${penalties}</div>
    `;
    scoresEl.appendChild(box);
  });

  document.getElementById("average").textContent =
    count ? (total / count).toFixed(2) : "â€”";
}

setInterval(loadScores, 2000);
loadScores();
</script>

</body>
</html>
