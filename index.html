<!--
CP Freestyle Judging System
File: index.html
Version: v1.0 (SECURE + FIXED)
Date: 2026-02-15
Notes:
- Secure judge + token enforcement
- FIX: Desktop + mobile hold-to-submit
- FIX: Haptics restored (slider + submit)
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CP Freestyle – Judge Panel</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #111;
  color: #fff;
  text-align: center;
  padding: 16px;
}
button {
  margin-top: 16px;
  font-size: 24px;
  padding: 14px;
  border-radius: 14px;
  border: none;
  background: #00c853;
  color: #fff;
  width: 90%;
  max-width: 320px;
}
button.locked { background: #555; }
</style>
</head>

<body>

<div id="judgeLabel">Judge: —</div>

<form id="scoreForm">
<input type="hidden" name="entry.759726589" id="judge">
<input type="hidden" name="entry.1544079831" id="score">

<div id="scoreText" style="font-size:80px">5.0</div>
<input id="slider" type="range" min="0" max="10" step="0.1" value="5">

<button type="button" id="submitBtn" class="locked">ACCESS DENIED</button>
</form>

<script>
const FORM_ENDPOINT =
  "https://docs.google.com/forms/d/e/1FAIpQLSfb2JIBic9mirDg9_CX80br3jmQ74vaLM3BJITnUDEXfmi0pg/formResponse";

/* ---------- Slider + haptics ---------- */
const slider = document.getElementById("slider");
const scoreText = document.getElementById("scoreText");
const scoreInput = document.getElementById("score");

let lastHaptic = 5.0;

slider.addEventListener("input", () => {
  const v = parseFloat(slider.value).toFixed(1);
  scoreText.textContent = v;
  scoreInput.value = v;

  if (Math.abs(v - lastHaptic) >= 0.5 && navigator.vibrate) {
    navigator.vibrate(10);
    lastHaptic = v;
  }
});

/* ---------- Hold to submit (mouse + touch) ---------- */
const submitBtn = document.getElementById("submitBtn");
let holdTimer = null;
let locked = false;

function startHold(e) {
  if (locked || submitBtn.classList.contains("locked")) return;
  e.preventDefault();
  holdTimer = setTimeout(submitScore, 350);
}

function cancelHold() {
  clearTimeout(holdTimer);
}

function submitScore() {
  fetch(FORM_ENDPOINT, {
    method: "POST",
    mode: "no-cors",
    body: new FormData(scoreForm)
  });

  if (navigator.vibrate) navigator.vibrate([25, 30, 25]);

  locked = true;
  submitBtn.textContent = "READY FOR NEXT RUN";
  submitBtn.classList.add("locked");
}

/* Desktop */
submitBtn.addEventListener("mousedown", startHold);
submitBtn.addEventListener("mouseup", cancelHold);
submitBtn.addEventListener("mouseleave", cancelHold);

/* Mobile */
submitBtn.addEventListener("touchstart", startHold, { passive: false });
submitBtn.addEventListener("touchend", cancelHold);
submitBtn.addEventListener("touchcancel", cancelHold);
</script>

</body>
</html>
